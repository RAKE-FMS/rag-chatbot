{
  "name": "chunk-and-embedding-skillset",
  "description": "Split /document/content into chunks and generate embeddings for each chunk using Azure OpenAI",
  "skills": [
    {
      "@odata.type": "#Microsoft.Skills.Text.SplitSkill",
      "name": "split-content",
      "description": "Split content into overlapping chunks for RAG",
      "context": "/document",
      "defaultLanguageCode": "ja",
      "textSplitMode": "pages",
      "maximumPageLength": 1000,
      "pageOverlapLength": 200,
      "maximumPagesToTake": 0,
      "inputs": [
        {
          "name": "text",
          "source": "/document/content"
        }
      ],
      "outputs": [
        {
          "name": "textItems",
          "targetName": "chunks"
        }
      ]
    },
    {
      "@odata.type": "#Microsoft.Skills.Text.AzureOpenAIEmbeddingSkill",
      "name": "embed-chunks",
      "description": "Generate embeddings for each chunk text",
      "context": "/document/chunks/*",
      "resourceUri": "__AOAI_ENDPOINT__",
      "apiKey": "__AOAI_KEY__",
      "deploymentId": "__AOAI_EMBEDDING_DEPLOYMENT__",
      "dimensions": 1536,
      "modelName": "text-embedding-3-small",
      "inputs": [
        {
          "name": "text",
          "source": "/document/chunks/*"
        }
      ],
      "outputs": [
        {
          "name": "embedding",
          "targetName": "contentVector"
        }
      ]
    }
  ],
  "indexProjections": {
    "selectors": [
      {
        "targetIndexName": "rag-index",
        "parentKeyFieldName": "parentId",
        "sourceContext": "/document/chunks/*",
        "mappings": [
          { "name": "content", "source": "/document/chunks/*" },
          { "name": "contentVector", "source": "/document/chunks/*/contentVector" },
          { "name": "title", "source": "/document/metadata_storage_name" }
        ]
      }
    ],
    "parameters": {
      "projectionMode": "skipIndexingParentDocuments"
    }
  }
}